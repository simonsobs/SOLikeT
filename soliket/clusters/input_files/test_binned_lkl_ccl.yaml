# Direction:
# download sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned from https://astro.ukzn.ac.za/~mjh/ACT/DR5CosmoSims/distribution/
# put in soliket/clusters/data/advact/DR5CosmoSims directory.


# run from SOLikeT/soliket/clusters
# command:
# $ cobaya-run input_files/test_binned_lkl_ccl.yaml -f
output: chains/test

likelihood:
  soliket.BinnedClusterLikelihood:
    verbose: True

    # Data
    data:
      data_path: 'data/advact/DR5CosmoSims/sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/' # Path to data directory
      cat_file: 'NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned_mass.fits' # Path to cluster catalog file
      Q_file: 'selFn/QFit.fits' # Path to Q function file
      tile_file: 'selFn/tileAreas.txt' # Path to tile file
      rms_file: 'selFn/RMSTab.fits' # Path to RMS file

    # Theory
    theorypred:
      choose_theory: "CCL"
      massfunc_mode: 'ccl'
      choose_dim: "2D"
      compl_mode: 'erf_diff'
      md_hmf: '500c'
      md_ym: '500c'
      use_class_sz : False

    # Y-M relation
    YM:
      Mpivot: 3e14 # Mpivot in Y-M relation

    # Selection function
    selfunc:
      SNRcut : 5. # S/N cutoff in number counts
      # Model for selection function, possibilities are
      # mode: Qfit / injection
      #   Qfit: using data output from nemo run
      #   injection: estimate completeness using source injection method from nemo (i.e. no Q)
      mode: 'injection'
      # Qmode: full / downsample
      #   downsample: average rms map, Q into n dwnsmpl_bins
      #   full: consider full map, Q function, no downsampling
      Qmode : 'downsample' #'full'
      dwnsmpl_bins : 5 # If Qmode=downsample, number of bins to use
      save_dwsmpld : True # Save downsampled Q and rms to npz file and once it exists read those
      average_Q : True # Use average Q function

    binning:
      # redshift bins for number counts
      z:
        zmin: 0.
        zmax: 2.8 #2.9
        dz: 0.1
      # SNR bins for number counts
      q:
        log10qmin: 0.6 #0.1
        log10qmax: 2.0
        dlog10q: 0.25 #2.0
      # mass bins for number counts
      M:
        Mmin: 1e13
        Mmax: 5e15
        dlogM: 0.05

params:
  # ombh2: 0.0226576  # for omb = 0.049
  # omch2: 0.1206864
  # ns: 0.965
  # tau: 0.055
  # mnu: 0.0
  # nnu: 3.046
  # omnuh2: 0.
  # w: -1

  h : 0.68
  n_s : 0.965
  Omega_b : 0.049
  Omega_c : 0.26
  # sigma8 : 0.81
  tenToA0 : 4.35e-5
  B0 : 0.08
  scatter_sz : 0.2
  bias_sz : 1.
  m_nu : 0.0
  C0 : 0. # doesnt matter

  # omega_b: 0.0226576
  # omega_cdm: 0.1206864
  # n_s: 0.965
  # tau: 0.055
  # H0: 68.

  sigma8:
    prior:
      min: 0.
      max: 4.
    ref:
      dist: norm
      loc: 0.8
      scale: 0.001
    proposal: 0.001
    latex: \sigma_8


sampler:
  evaluate:
      override:
        sigma8: 0.81

theory:
  soliket.clusters.CCL :
      transfer_function : 'boltzmann_camb'
      matter_pk : 'halofit'
      baryons_pk : 'nobaryons'
      md_hmf : '500c'
  # classy:
  #   stop_at_error: true
  #   extra_args:
      # N_ur: 3.046
      # N_ncdm: 0.
      # N_ur: 2.0328,
      # N_ncdm : 1,
      # m_ncdm : 0.06,
      # T_ncdm : 0.71611,
# theory:
#   # camb:
#   #   extra_args:
#   #     num_massive_neutrinos: 0
#   camb:
#     stop_at_error: true
#     extra_args:
#       num_massive_neutrinos: 0
#       dark_energy_model: fluid
#     ignore_obsolete: True
  # camb:
  #   stop_at_error: true
  #   extra_args:
  #     num_massive_neutrinos: 0
  #     dark_energy_model: fluid
  #   ignore_obsolete: True
  # camb:
    # provides: H0

stop_at_error: True
