# Direction:
# download sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned from https://astro.ukzn.ac.za/~mjh/ACT/DR5CosmoSims/distribution/
# put in soliket/clusters/data/advact/DR5CosmoSims directory.


# run from SOLikeT/soliket/clusters
# command:
# $ cobaya-run input_files/test_unbinned_lkl_camb.yaml -f

output: chains/test_unbinned

likelihood:
  soliket.UnbinnedClusterLikelihood:
    stop_at_error: True
    verbose: True
    #
    # Data
    data:
      data_path: 'data/advact/DR5CosmoSims/sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/' # Path to data directory
      #data_path: 'data/advact/DR5CosmoSims/sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/NemoCCL_A10tSZ_DR5White_ACT-DR5/' # Path to data directory
      cat_file: 'NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned_mass.fits' # Path to cluster catalog file
      #cat_file: 'NemoCCL_A10tSZ_DR5White_ACT-DR5_mass.fits' # Path to cluster catalog file
      Q_file: 'selFn/QFit.fits' # Path to Q function file
      tile_file: 'selFn/tileAreas.txt' # Path to tile file
      rms_file: 'selFn/RMSTab.fits' # Path to RMS file

    # Y-M relation
    YM:
      Mpivot: 4.25e14 # Mpivot in Y-M relation


    # Selection function
    selfunc:
      SNRcut : 5. # S/N cutoff in number counts
      # Model for selection function, possibilities are
      method: 'SNRbased'
      # method: SNRbased / injection
      #   SNRbased: completeness based in SNR bins
      #   injection: estimate completeness using source injection method from nemo (i.e. no Q)
      whichQ: 'fit' #'injection'
      # whichQ: fit / injection
      #   fit : using Q fit data
      #   injection : using Q source injection data
      resolution : 'downsample'
      # resolution: full / downsample
      #   downsample: average rms map, Q into n dwnsmpl_bins
      #   full: consider full map, Q function, no downsampling
      dwnsmpl_bins : 50 # If resolution=downsample, number of bins to use
      save_dwsmpld : False # Save downsampled Q and rms to npz file and once it exists read those

    # theorypred:
    #   choose_theory: 'camb' # Theory prediction mode, possibilities are camb, class, CCL (CCL is all CCL)
    theorypred:
      choose_theory: "CCL"
      massfunc_mode: 'ccl'
      md_hmf: '200c'
      md_ym: '200c'
      use_class_sz : False

    binning:
      z:
        zmin: 0.
        zmax: 2.
        dz: 0.1
      M:
        Mmin: 5e13
        Mmax: 1e16
        dlogM: 0.01
params:
  h : 0.68
  n_s : 0.965
  Omega_b : 0.049
  Omega_c : 0.261
  # sigma8 : 0.81
  tenToA0 : 1.9e-5
  B0 : 0.08
  scatter_sz : 0.
  bias_sz : 1.
  m_nu : 0.0
  C0 : 0. # doesnt matter

  sigma8:
    prior:
      min: 0.
      max: 4.
    ref:
      dist: norm
      loc: 0.8
      scale: 0.001
    proposal: 0.001
    latex: \sigma_8

sampler:
  evaluate:
      override:
        sigma8: 0.81

theory:
  soliket.clusters.CCL :
      transfer_function : 'boltzmann_camb'
      matter_pk : 'halofit'
      baryons_pk : 'nobaryons'
      md_hmf : '200c'

stop_at_error: True
