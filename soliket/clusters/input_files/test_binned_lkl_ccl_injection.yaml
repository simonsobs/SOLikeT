# run from SOLikeT/soliket/clusters
# command:
# $ cobaya-run input_files/test_binned_lkl_ccl_injection.yaml -f
output: chains/test

likelihood:
  soliket.BinnedClusterLikelihood:
    verbose : True

    # Data
    data:
      data_path: '/Users/boris/Work/CLASS-SZ/SO-SZ/SOLikeT/soliket/clusters/data/advact/DR5CosmoSims/sim-kit_NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned/' # Path to data directory
      cat_file: 'NemoCCL_A10tSZ_DR5White_ACT-DR5_tenToA0Tuned_mass.fits' # Path to cluster catalog file
      Q_file: 'selFn/QFit.fits' # Path to Q function file
      tile_file: 'selFn/tileAreas.txt' # Path to tile file
      rms_file: 'selFn/RMSTab.fits' # Path to RMS file

    # Theory
    theorypred:
      choose_dim: '2D' # Specify if likelihood in terms of N(q, z) (2D) or N(z) (1D)
      choose_theory: 'CCL' # Theory prediction mode, possibilities are camb, class, CCL (CCL is all CCL)
      rel_correction: False # Relativistic corrections for tSZ
      massfunc_mode: 'ccl' # Method to compute mass function, possibilities are ccl, internal (Eunseong's implementation)
      md_hmf: '200c' # Mass definition used for HMF
      md_ym: '200c' # Mass definition used for Y-M relation
      compl_mode: 'erf_diff' # Method to compute selection function, possibilities are erf_diff (difference of erfs), erf_prod (product of erfs)

    # Y-M relation
    YM:
      Mpivot: 2.9e14 # Mpivot in Y-M relation

    # Selection function
    selfunc:
      SNRcut: 5. # S/N cutoff in number counts
      # Model for selection function, possibilities are
      # downsample: average rms map, Q into n dwnsmpl_bins
      # inpt_dwnsampld: input rms, Q already pre-downsampled
      # full: consider full map, Q function, no downsampling
      # single_tile: run for single tile, no downsampling
      # injection: estimate completeness using source injection method from nemo (i.e. no Q)
      mode: 'injection'
      dwnsmpl_bins: 50 # If mode=downsample, number of bins to use
      save_dwsmpld: False # Save downsampled Q and rms to npz file and once it exists read those
      average_Q: False # Use average Q function

    binning:
      # redshift bins for number counts
      z:
        zmin: 0.
        zmax: 2.8
        dz: 0.1
      # SNR bins for number counts
      q:
        log10qmin: 0.6
        log10qmax: 2.0
        dlog10q: 0.25
      # mass bins for number counts
      M:
        Mmin: 3.4e13
        Mmax: 0.68e16
        dlogM: 0.05

params:
  h: 0.68
  n_s: 0.965
  Omega_b: 0.049
  Omega_c: 0.26
  sigma8: 0.81
  tenToA0: 1.9e-05
  B0: 0.08
  scatter_sz: 0.
  bias_sz: 1.
  m_nu: 0.0
  C0: 2

#  sigma8:
#    latex: \sigma_8
#  Omega_m:
#    latex: \Omega_\mathrm{m}

sampler:
  evaluate:
#      override:
#        logA: 3.007

theory:
  soliket.clusters.CCL:
    transfer_function: 'boltzmann_camb'
    matter_pk: 'halofit'
    baryons_pk: 'nobaryons'
    md_hmf: '200c'

stop_at_error: true
